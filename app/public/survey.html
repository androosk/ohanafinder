<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Ohana Finder Survey</title>
	<!-- Bootstrap, jQuery, and local CSS links -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<!-- Chosen - a jQuery plugin library by Harvest to prettify the survey menu -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>

</head>

<body>

	<div class="container">
		<h2>Survey Questions</h2>
		<h3><strong>Who are You?</strong></h3>
		<h4>Name (Required)</h4>
		<input type="text" name="" id="name" class="form-control" required >
		<h4>Link to Photo Image (Required)</h4>
		<input type="text" name="" id="photo" class="form-control" required >
		<hr>
		<h3><strong>Question 1</strong></h3>
		<h4>You prefer order over chaos.</h4>
		<select data-placeholder="" class="chosen-select" id="question-one">
			<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 2</strong></h3>
		<h4>You prefer a night at home with your aminals to going out with friends.</h4>
		<select data-placeholder="" class="chosen-select" id="question-two">
			<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 3</strong></h3>
		<h4>You can only get things done under pressure.</h4>
		<select data-placeholder="" class="chosen-select" id="question-three">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 4</strong></h3>
		<h4>You prefer the great outdoors to staying inside.</h4>
		<select data-placeholder="" class="chosen-select" id="question-four">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 5</strong></h3>
		<h4>You are a people person.</h4>
		<select data-placeholder="" class="chosen-select" id="question-five">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 6</strong></h3>
		<h4>You would rather read a book than watch TV.</h4>
		<select data-placeholder="" class="chosen-select" id="question-six">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 7</strong></h3>
		<h4>You are sensitive to the feelings of others in conversation.</h4>
		<select data-placeholder="" class="chosen-select" id="question-seven">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 8</strong></h3>
		<h4>You prefer your fantasies to your reality.</h4>
		<select data-placeholder="" class="chosen-select" id="question-eight">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 9</strong></h3>
		<h4>You listen well and like to help others figure out how to solve their problems.</h4>
		<select data-placeholder="" class="chosen-select" id="question-nine">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>

		<h3><strong>Question 10</strong></h3>
		<h4>Aminals are family.</h4>
		<select data-placeholder="" class="chosen-select" id="question-ten">
		<option value=""></option>
			<option value="1">1 (Strongly Disagree)</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5 (Strongly Agree)</option>
		</select>
		<br><br>
		<!-- Submit Button -->
		<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">Submit</button>
		<hr>
	</div>
	<div class="container">
		<p><a href="/api/ohana">API Ohana List</a> | <a href="https://github.com/androosk/ohanafinder">GitHub Repo</a></p>
	</div>
	<!-- Bootstrap Modal for displaying survey results -->
	<div id="resultsModal" class="modal fade" role="dialog">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h2 class="modal-title"><strong>Best Match</strong></h2>
	      </div>
	      <div class="modal-body">
	        <h2 id="matchName"></h2>
	        <img id="matchImg" src="" alt="">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>
	<!-- Bootstrap Modal for failure to fill out all survey fields -->
	<div id="failureModal" class="modal fade" role="dialog">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h2 class="modal-title"><strong>Form Error</strong></h2>
	      </div>
	      <div class="modal-body">
	        <h2>Please fill out all fields before submitting!</h2>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

<!-- //This section evaluates the form data, returns the closest match, and adds the user to the data set -->
  <script type="text/javascript">
  	// CSS Styling for survey drop downs from Chosen.js
    var config = {
      '.chosen-select'           : {},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10},
      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }
    // Validate and capture form data
    $("#submit").on("click", ()=>{
    	function validateForm() {
		  var isValid = true;
		  $('.form-control, .chosen-select').each(function() {
		    if (!$(this).val())
						isValid = false;
		  })
			return isValid
		}

		// If all required fields are filled
		if (validateForm())
		{
			// Create an object for the user's data
	    	var userData = {
	    		name: $('#name').val(),
	    		photo: $('#photo').val(),
	    		scores: [$('#question-one').val(), $('#question-two').val(), $('#question-three').val(), $('#question-four').val(), $('#question-five').val(), $('#question-six').val(), $('#question-seven').val(), $('#question-eight').val(), $('#question-nine').val(), $('#question-ten').val()]
	    	}
	    	// AJAX post the data to the ohana API.
	    	$.post('/api/ohana', userData, function(data){
	    		// Grab the result from the AJAX post so that the best match's name and photo are displayed.
	    		$('#matchName').text(data.name)
	    		$('#matchImg').attr('src',data.photo)
		    	// Show the modal with the best match
		    	$('#resultsModal').modal('toggle')
	    	});
		}
		else // If user has not filled out all survey fields, ask them to do so
		{
			$('#failureModal').modal('toggle')
		}
    	return false
    })
  </script>
</body>
</html>
